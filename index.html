<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Лекция 6. Процессы и потоки</title>
<meta http-equiv="Content-Language" content="English" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link rel="stylesheet" type="text/css" href="style.css" media="screen" />
</head>
<body>

<div id="wrap">
<div id="header">
<h1><a href="#">Лекция 6. Процессы и потоки</a></h1></div>
<div id="menu"></div>
<div id="content">
<div class="left">
<h2>1 Многозадачность</h2>
<a name="1-1-Многозадачность"></a>
<h4>Понятие многозадачности</h4><a name="3-100-Понятие многозадачности"></a>
<p><i>Многозадачность</i> (multitasking), — это способ организации вычислительного процесса, при котором на одном процессоре попеременно выполняются сразу несколько программ. Эти программы совместно используют не только процессор, но и другие ресурсы компьютера: оперативную и внешнюю память, устройства ввода-вывода, данные. Мультипрограммирование призвано повысить эффективность использования вычислительной системы.
</p><br>

<p>ОС делятся на несколько типов по режиму многозадачности:
</p><ol>
<li> системы пакетной обработки;
<li> системы разделения времениж
<li> системы реального времени.
</ol>
<h3>1.1 Пакетная обработка</h3>
<a name="2-2-Пакетная обработка"></a>
<p>Системы <b>пакетной обработки</b> предназначались для решения задач в основном вычислительного характера, не требующих быстрого получения результатов. Главной целью и критерием эффективности систем пакетной обработки является максимальная пропускная способность, то есть решение максимального числа задач в единицу времени.
</p><br>

<ul>
<li> В начале работы формируется пакет заданий, каждое задание содержит требование к системным ресурсам; 
<li> из этого пакета заданий формируется мультипрограммная смесь, то есть множество одновременно выполняемых задач. Для одновременного выполнения выбираются задачи, предъявляющие разные требования к ресурсам, так, чтобы обеспечивалась сбалансированная загрузка всех устройств вычислительной машины. 
</ul>
<p>Например, в мультипрограммной смеси желательно одновременное присутствие вычислительных задач и задач с интенсивным вводом-выводом. Таким образом, выбор нового задания из пакета заданий зависит от внутренней ситуации, складывающейся в системе, то есть выбирается «выгодное» задание. Следовательно, в вычислительных системах, работающих под управлением пакетных ОС, невозможно гарантировать выполнение того или иного задания в течение определенного периода времени. 
</p><br>

<p>Один из способов совмещения вычислений с операциями ввода-вывода реализуется в компьютерах, в которых внешние устройства управляются не процессором ввода-вывода, а контроллерами. 
</p><br>

<p>Каждое внешнее устройство (или группа внешних устройств одного типа) имеет свой собственный контроллер, который автономно отрабатывает команды, поступающие от центрального процессора. 
</p><p>При этом контроллер и центральный процессор работают асинхронно. Поскольку многие внешние устройства включают электромеханические узлы, контроллер выполняет свои команды управления устройствами существенно медленнее, чем центральный процессор — свои. Это обстоятельство используется для организации параллельного выполнения вычислений и операций ввода-вывода: в промежутке между передачей команд, контроллеру центральный процессор может выполнять вычисления.
</p><br>

<p> Контроллер может сообщить центральному процессору о том, что он готов принять следующую команду, сигналом прерывания либо центральный процессор узнает об этом, периодически опрашивая состояние контроллера. 
</p><p>В системах пакетной обработки переключение процессора с выполнения одной задачи на выполнение другой происходит по инициативе самой активной задачи, например, когда она отказывается от процессора из-за необходимости выполнить операцию ввода-вывода. Поэтому существует высокая вероятность того, что одна задача может надолго занять процессор и выполнение интерактивных задач станет невозможным. 
</p><br>

<p>Взаимодействие пользователя с вычислительной машиной, на которой установлена система пакетной обработки, сводится к тому, что он приносит задание, отдает его диспетчеру-оператору, а в конце дня после выполнения всего пакета заданий получает результат. 
</p><br>

<p>Очевидно, что такой порядок повышает эффективность функционирования аппаратуры, но снижает эффективность работы пользователя.
</p><h3>1.2 Разделение времени</h3>
<a name="2-3-Разделение времени"></a>
<p>В системах <b>разделения времени</b> пользователям (или одному пользователю) предоставляется возможность интерактивной работы сразу с несколькими приложениями. Для этого каждое приложение должно регулярно получать возможность «общения» с пользователем. Понятно, что в пакетных системах возможности диалога пользователя с приложением весьма ограничены.
</p><br>

<p>В системах разделения времени эта проблема решается за счет того, что ОС принудительно периодически приостанавливает приложения, не дожидаясь, когда они добровольно освободят процессор. Всем приложениям попеременно выделяется квант процессорного времени, таким образом пользователи, запустившие программы на выполнение, получают возможность поддерживать с ними диалог.
</p><p>Системы разделения времени призваны исправить основной недостаток систем пакетной обработки — изоляцию пользователя-программиста от процесса выполнения его задач. Каждому пользователю в этом случае предоставляется терминал, с которого он может вести диалог со своей программой. Так как в системах разделения времени каждой задаче выделяется только квант процессорного времени, ни одна задача не занимает процессор надолго и время ответа оказывается приемлемым. Если квант выбран достаточно небольшим, то у всех пользователей, одновременно работающих на одной и той же машине, складывается впечатление, что каждый из них единолично использует машину.
</p><p>Системы разделения времени обладают меньшей пропускной способностью, чем системы пакетной обработки, так как на выполнение принимается каждая запущенная пользователем задача, а не та, которая «выгодна» системе. 
</p><br>

<p>Производительность системы снижается из-за возросших накладных расходов вычислительной мощности на более частое переключение процессора с задачи на задачу. Это вполне соответствует тому, что критерием эффективности систем разделения времени является не максимальная пропускная способность, а удобство и эффективность работы пользователя. 
</p><br>

<p>Вместе с тем мультипрограммное выполнение интерактивных приложений повышает и пропускную способность компьютера (пусть и не в такой степени, как пакетные системы). Аппаратура загружается лучше, поскольку в то время, пока одно приложение ждет сообщения пользователя, другие приложения могут обрабатываться процессором.
</p><h3>1.3 Реальное время</h3>
<a name="2-4-Реальное время"></a>
<p>В системах реального времени мультипрограммная смесь представляет собой фиксированный набор заранее разработанных программ, а выбор программы на выполнение осуществляется по прерываниям (исходя из текущего состояния объекта) или в соответствии с расписанием плановых работ.
</p><br>

<p>Способность аппаратуры компьютера и ОС к быстрому ответу зависит в основном от скорости переключения с одной задачи на другую и, в частности, от скорости обработки сигналов прерывания. Если при возникновении прерывания процессор должен опросить сотни потенциальных источников прерывания, то реакция системы будет слишком медленной. Время обработки прерывания в системах реального времени часто определяет требования к классу процессора даже при небольшой его загрузке. 
</p><h3>1.4 Мультипроцессорная обработка</h3>
<a name="2-5-Мультипроцессорная обработка"></a>
<p><i>Мультипроцессорная обработка</i> — это способ организации вычислительного процесса в системах с несколькими процессорами, при котором несколько задач (процессов, потоков) могут одновременно выполняться на разных процессорах системы. 
</p><br>

<p>Мультипроцессорные системы часто характеризуют либо как <b>симметричные</b>, либо как <b>несимметричные</b>. При этом следует четко определять, к какому аспекту мультипроцессорной системы относится эта характеристика — к типу архитектуры или к способу организации вычислительного процесса. 
</p><p><b>Симметричная</b> архитектура мультипроцессорной системы предполагает однородность всех процессоров и единообразие включения процессоров в общую схему мультипроцессорной системы. Традиционные симметричные мультипроцессорные конфигурации разделяют одну большую память между всеми процессорами.
</p><br>

<p><b>Масштабируемость</b>, или возможность наращивания числа процессоров, в симметричных системах ограничена вследствие того, что все они пользуются одной и той же оперативной памятью и, следовательно, должны располагаться в одном корпусе. Такая конструкция, называемая масштабируемой по вертикали, практически ограничивает число процессоров до четырех или восьми. 
</p><p>В <b>асимметричной</b> архитектуре разные процессоры могут отличаться как своими характеристиками (производительностью, надежностью, системой команд и т. д., вплоть до модели микропроцессора), так и функциональной ролью, которая поручается им в системе. Например, одни процессоры могут предназначаться для работы в качестве основных вычислителей, другие — для управления подсистемой ввода-вывода, третьи — еще для каких-то особых целей.
</p><br>

<p><b>Масштабирование</b> в асимметричной архитектуре реализуется иначе, чем в симметричной. Так как требование единого корпуса отсутствует, система может состоять из нескольких устройств, каждое из которых содержит один или несколько процессоров. Это масштабирование по горизонтали. Каждое такое устройство называется кластером, а вся мультипроцессорная система — кластерной. 
</p><p><b>Асимметричное</b> мультипроцессирование является наиболее простым способом организации вычислительного процесса в системах с несколькими процессорами. Этот способ часто называют также <i>«ведущий-ведомый»</i>.
</p><br>

<p>Функционирование системы по принципу <i>«ведущий-ведомый»</i> предполагает выделение одного из процессоров в качестве «ведущего», на котором работает операционная система и который управляет всеми остальными «ведомыми» процессорами. То есть ведущий процессор берет на себя функции распределения задач и ресурсов, а ведомые процессоры работают только как обрабатывающие устройства и никаких действий по организации работы вычислительной системы не выполняют. 
</p><h2>2 Процессы и потоки</h2>
<a name="1-6-Процессы и потоки"></a>
<h3>2.1 Понятие процесса</h3>
<a name="2-7-Понятие процесса"></a>
<p><i>Процесс</i> (или по-другому, задача) - абстракция, описывающая выполняющуюся программу. 
</p><br>

<p>Для операционной системы <b>процесс</b> представляет собой единицу работы, заявку на потребление системных ресурсов. 
</p><br>

<p><i>Подсистема управления процессами</i> планирует выполнение процессов, то есть распределяет процессорное время между несколькими одновременно существующими в системе процессами, а также занимается созданием и уничтожением процессов, обеспечивает процессы необходимыми системными ресурсами, поддерживает взаимодействие между процессами. 
</p><p>С каждым процессом связывается его <i>адресное пространство</i>, из которого он может читать и в которое он может писать данные.
</p><br>

<p>Адресное пространство содержит:
</p><ol>
<li> саму программу
<li> данные к программе
<li> стек программы
</ol>
<p>С каждым процессом связывается набор регистров, например:
</p><ul>
<li> счетчика команд (в процессоре) - регистр в котором содержится адрес следующей, стоящей в очереди на выполнение команды. После того как команда выбрана из памяти, счетчик команд корректируется и указатель переходит к следующей команде.
<li> указатель стека
<li> и д.р.
</ul>
<p>На протяжении существования процесса его выполнение может быть многократно прервано и продолжено. Для того, чтобы возобновить выполнение процесса, необходимо восстановить состояние его операционной среды. Состояние операционной среды отображается состоянием регистров и программного счетчика, режимом работы процессора, указателями на открытые файлы, информацией о незавершенных операциях ввода-вывода, кодами ошибок выполняемых данным процессом системных вызовов и т.д. Эта информация называется <i>контекстом</i> процесса. 
</p><br>

<p>Кроме этого, операционной системе для реализации планирования процессов требуется дополнительная информация: идентификатор процесса, состояние процесса, данные о степени привилегированности процесса, место нахождения кодового сегмента и другая информация. В некоторых ОС (например, в ОС UNIX) информацию такого рода, используемую ОС для планирования процессов, называют <i>дескриптором</i> процесса.
</p><p><b>Дескриптор</b> процесса по сравнению с <b>контекстом</b> содержит более оперативную информацию, которая должна быть легко доступна подсистеме планирования процессов. Контекст процесса содержит менее актуальную информацию и используется операционной системой только после того, как принято решение о возобновлении прерванного процесса.
</p><br>

<p><b>Очереди</b> процессов представляют собой <b>дескрипторы</b> отдельных процессов, объединенные в списки. Таким образом, каждый дескриптор, кроме всего прочего, содержит по крайней мере один указатель на другой дескриптор, соседствующий с ним в очереди. Такая организация очередей позволяет легко их переупорядочивать, включать и исключать процессы, переводить процессы из одного состояния в другое. 
</p><p>Программный код только тогда начнет выполняться, когда для него операционной системой будет создан процесс. Создать процесс - это значит:
</p><ol>
<li> создать информационные структуры, описывающие данный процесс, то есть его дескриптор и контекст;
<li> включить дескриптор нового процесса в очередь готовых процессов;
<li> загрузить кодовый сегмент процесса в оперативную память или в область свопинга. 
</ol>
<h3>2.2 Модель процесса</h3>
<a name="2-8-Модель процесса"></a>
<p>В многозадачной системе реальный процессор переключается с процесса на процесс, но для упрощения модели рассматривается набор процессов, идущих параллельно (псевдопараллельно).
</p><br>

<p>Рассмотрим схему с четырьмя работающими программами.
</p><br>



<img src='2-1.png'>

<p>В каждый момент времени активен только один процесс
</p>

<img src='2-2.png'>

<br>

<p>Справа представлены параллельно работающие процессы, каждый со своим счетчиком команд. Разумеется, на самом деле существует только один физический счетчик команд,  в который загружается логический счетчик команд текущего процесса. Когда время, отведенное текущему процессу, заканчивается, физический счетчик команд сохраняется в памяти, в логическом счетчике команд процесса.
</p><h3>2.3 Иерархия процессов</h3>
<a name="2-9-Иерархия процессов"></a>
<p>В UNIX системах заложена жесткая <b>иерархия</b> процессов. Каждый новый процесс созданный системным вызовом <b>fork</b>, является <i>дочерним</i> к предыдущему процессу. Дочернему процессу достаются от родительского переменные, регистры и т.п. После вызова fork, как только родительские данные скопированы, последующие изменения в одном из процессов не влияют на другой, но процессы помнят о том, кто является родительским.
</p><br>

<p>В UNIX существует прародитель всех процессов - процесс <b>init</b>.
</p>

<img src='2-3.png'><p>Дерево процессов для систем UNIX
</p>

<br>

<p>В Windows не существует понятия иерархии процессов. Хотя можно задать специальный маркер родительскому процессу, позволяющий контролировать дочерний процесс.
</p><h3>2.4 Понятие потока</h3>
<a name="2-10-Понятие потока"></a>
<p>Каждому процессу соответствует адресное пространство и одиночный поток исполняемых команд. В многопользовательских системах, при каждом обращении к одному и тому же сервису, приходится создавать новый процесс для обслуживания клиента. Это менее выгодно, чем создать квазипараллельный поток внутри этого процесса с одним адресным пространством.
</p><br>

<p>Современные ОС предлагают механизм <b>многопоточной</b> обработки (multithreading). При этом вводится новая единица работы — <i>поток выполнения</i>, а понятие <b>«процесс»</b> в значительной степени меняет смысл. Понятию «поток» соответствует последовательный переход процессора от одной команды программы к другой. ОС распределяет процессорное время между потоками. Процессу ОС назначает адресное пространство и набор ресурсов, которые совместно используются всеми его потоками. 
</p>

<img src='2-5.png'><p>Сравнение многопоточной системы с однопоточной
</p>

<p>С каждым потоком связывается:
</p><ol>
<li> Счетчик выполнения команд
<li> Регистры для текущих переменных
<li> Стек
<li> Состояние
</ol>
<p>Потоки делят между собой элементы своего процесса:
</p><ol>
<li> Адресное пространство
<li> Глобальные переменные
<li> Открытые файлы
<li> Таймеры
<li> Семафоры
<li> Статистическую информацию. 
</ol>
<p>В остальном модель идентична модели процессов.
</p><p>В POSIX и Windows есть поддержка потоков на уровне ядра.
</p><p>В Linux есть новый системный вызов <b>clone</b> для создания потоков, отсутствующий во всех остальных версиях системы UNIX.
</p><p>В POSIX есть новый системный вызов <b>pthread_create</b> для создания потоков.
</p><p>В Windows есть новый системный вызов <b>Createthread</b> для создания потоков.
</p><p>Преимущества использования потоков:
</p><ol>
<li> Упрощение программы в некоторых случаях, за счет использования общего адресного пространства.
<li> Быстрота создания потока, по сравнению с процессом, примерно в 100 раз.
<li> Повышение производительности самой программы, т.к. есть возможность одновременно выполнять вычисления на процессоре и операцию ввода/вывода. Пример: текстовый редактор с тремя потоками может одновременно взаимодействовать с пользователем, форматировать текст и записывать на диск резервную копию.
</ol>
<a name="1-11-Вопросы для самопроверки"></a>


<h2>Вопросы для самоконтроля</h2>

<ol>
</ol>
</div>
<div class="right">
<h2>Разделы :</h2>

<ul>
<li><a href="#1-1-Многозадачность">Многозадачность</a></li>
<ul>
<li><a href="#2-2-Пакетная обработка">Пакетная обработка</a></li><li><a href="#2-3-Разделение времени">Разделение времени</a></li><li><a href="#2-4-Реальное время">Реальное время</a></li><li><a href="#2-5-Мультипроцессорная обработка">Мультипроцессорная обработка</a></li>
</ul>
<li><a href="#1-6-Процессы и потоки">Процессы и потоки</a></li>
<ul>
<li><a href="#2-7-Понятие процесса">Понятие процесса</a></li><li><a href="#2-8-Модель процесса">Модель процесса</a></li><li><a href="#2-9-Иерархия процессов">Иерархия процессов</a></li><li><a href="#2-10-Понятие потока">Понятие потока</a></li>
</ul>
<li><a href="#1-11-Вопросы для самопроверки">Вопросы для самопроверки</a></li></ul></div>
<div style="clear: both;"> </div>

</div>

<div id="footer">
</div>

</div>

</body>
</html>

